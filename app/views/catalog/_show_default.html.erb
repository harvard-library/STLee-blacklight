<% doc_presenter = show_presenter(document) %>
<%# default partial to display solr document fields in catalog show view -%>

<div class="row">
  <div class="col-lg-8">
    <div id="details" class="content active record-details">
      <dl class="row">
        <% document_show_fields(document).each do |field_name, field| -%>
          <% if should_render_show_field? document, field %>
            <dt class="blacklight-<%= field_name.parameterize %>"><%= render_document_show_field_label document, field: field_name %></dt>
            <dd class="blacklight-<%= field_name.parameterize %>"><%=raw CGI.unescapeHTML doc_presenter.field_value field_name %></dd>
          <% end -%>
        <% end -%>
      </dl>
    </div> 
  </div>
  <div class="col-lg-4">
    <div id="tools" class="record-tools">
      <h2 class="clearfix">Tools &amp; Related Links</h2>
        <%if document[:delivery_service] == 'ids' or document[:delivery_service] == 'pds'%>
          
          <%if document[:delivery_service] == 'ids'%>
          <div class="btn-group">
          <button type="button" class="btn btn-dark dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             Download This Item <span class="caret"></span>
           </button>
           <ul class="dropdown-menu">
              <%image_base_url = 'https://ids.lib.harvard.edu/ids/iiif/' + document[:drs_file_id]
              json_answer = retrieve_still_image_json_metadata(image_base_url+ '/info.json')
              if json_answer
                size_and_labels = [[300, "Small: %d x %d px"],[800, "Medium: %d x %d px"],
                                    [1200, "Large: %d x %d px"],[2400, "X-Large: %d x %d px"]]
                max_width = json_answer['maxWidth'].to_i
                max_height = json_answer['maxHeight'].to_i
                ratio = json_answer['height']/json_answer['width'].to_f
                download_url = image_base_url + '/full/%d,/0/default.jpg?download&caption'
                for i in 0..size_and_labels.length-1 do
                  size_elem = size_and_labels[i]
                  if size_elem[0] <= max_width
                  %>
                    <li>
                      <a href="<%= download_url % size_elem[0] %>"><%= size_elem[1] % [size_elem[0], (ratio*(size_elem[0].to_f)).floor] %>
                      </a>
                    </li>
                  <%elsif i != size_and_labels.length-1 and max_width < size_and_labels[i+1][0]%>
                    <li>
                      <a href="<%= download_url % size_elem[0] %>"><%= size_elem[1] % [max_width, (ratio*(max_width.to_f)).floor] %>
                      </a>
                    </li>
                    <%break 'break'
                  end
                end
              end%>
            </ul>
            </div>
          <%end%>
         <div class="btn-group">
           <%
              del_serv = document[:delivery_service]
              manifest_base_url = 'https://iiif.lib.harvard.edu/manifests/' 
              id_prefix = (del_serv == 'pds'? 'drs': del_serv) + ':'
            %>
           <button type="button" class="hl__button hl__button--small hl__button--inline iiif_logo  " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><%= image_tag("IIIFLogoBlack.svg", alt: "IIIF logo") %><span class="caret"></span>
           </button>
           <ul class="dropdown-menu">
              <script>
                function copyManifestToClipBoard(manifest_url) {
                  const el = document.createElement('textarea');
                  el.value = manifest_url;
                  document.body.appendChild(el);
                  el.select();
                  document.execCommand('copy');
                  alert("Copied the text: '" + el.value + "' to clipboard");
                  document.body.removeChild(el);
                }
              </script>
              <li><a href="javascript:void(0);" onclick="copyManifestToClipBoard('<%=manifest_base_url+id_prefix+document[:drs_file_id]%>')">Copy Manifest Link</a></li>
            </li>
            <%if del_serv == 'pds'%>
              <li><a href="<%= manifest_base_url+'view/'+id_prefix+document[:drs_file_id]%>" target="_blank">Open in Mirador</a></li>
            <%end%>
           </ul>
          </div>
       <%end%>
        <%
        if !document[:permalink].nil? && document[:permalink].kind_of?(String) && document[:permalink] != ''
          %>
            <div class="permalink"><a href="<%=document[:permalink]%>">Permalink</a></div>
          <%
        end
        %>
        <%
        if !document[:digital_collections_links].nil? && document[:digital_collections_links].kind_of?(Array) && document[:digital_collections_links].length > 0
          %>
            <dl class="dl-vertical dl-invert dl-appears-in clearfix">
            <dt class="blacklight-title_extended">This item appears in</dt>
          <%
          document[:digital_collections_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:label]%></a></dd>
          <%
          end
          %>
            </dl>
          <%
        end
        %>

      <dl class="dl-vertical dl-invert dl-more-details clearfix">
        <%
        if (!document[:hollis_links].nil? && document[:hollis_links].kind_of?(Array) && document[:hollis_links].length > 0)  ||
        (!document[:hollis_image_links].nil? && document[:hollis_image_links].kind_of?(Array) && document[:hollis_image_links].length > 0) ||
        (!document[:finding_aid_links].nil? && document[:finding_aid_links].kind_of?(Array) && document[:finding_aid_links].length > 0)
        %>
          <dt class="blacklight-title_extended clearfix">More item details</dt>
        <%
        end
        if !document[:hollis_links].nil? && document[:hollis_links].kind_of?(Array)
          document[:hollis_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end

        if !document[:hollis_image_links].nil? && document[:hollis_image_links].kind_of?(Array)
          document[:hollis_image_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end

        if !document[:finding_aid_links].nil? && document[:finding_aid_links].kind_of?(Array)
          document[:finding_aid_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end
        %>
      </dl>
    </div>
  </div>
</div>
