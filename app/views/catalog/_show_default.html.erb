<% doc_presenter = show_presenter(document) %>
<%# default partial to display solr document fields in catalog show view -%>

<div class="row">
  <div class="col-lg-8">
    <div id="details" class="content active record-details">
      <dl class="row">
        <% document_show_fields(document).each do |field_name, field| -%>
          <% if should_render_show_field? document, field %>
            <dt class="blacklight-<%= field_name.parameterize %>"><%= render_document_show_field_label document, field: field_name %></dt>
            <dd class="blacklight-<%= field_name.parameterize %>"><%=raw CGI.unescapeHTML doc_presenter.field_value field_name %></dd>
          <% end -%>
        <% end -%>
      </dl>
    </div> 
  </div>
  <div class="col-lg-4">
    <div id="tools" class="record-tools">
      <h2 class="clearfix">Tools and Related Links</h2>
        <% if document[:delivery_service] == 'ids' or document[:delivery_service] == 'pds'%>
          <div class="btn-group">
          <button type="button" class="btn btn-dark dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
             Download This Item <span class="caret"></span>
           </button>
           <ul class="dropdown-menu">
            
            <%if document[:delivery_service] == 'ids'%>
              <% 
              size_and_labels = [ [300, 'Small: 300 x %d px'],
                                  [800, 'Medium: 800 x %d px'],
                                  [1200, 'Large: 1200 x %d px'],
                                  [2400, 'X-Large: 2400 x %d px']]
              image_base_url = 'https://ids.lib.harvard.edu/ids/iiif/' + document[:drs_file_id]
              json_answer = retrieve_still_image_json_metadata(image_base_url+ '/info.json')
              max_width = json_answer['width']
              max_height = json_answer['height']
              ratio = (max_height.to_f)/(max_width.to_f)
              download_url = image_base_url + '/full/%d,/0/default.jpg?download&caption'
              %>
                <%for size_elem in size_and_labels do%>
                  <%if size_elem[0] <= max_width%>
                    <li><a href="<%= download_url % size_elem[0] %>"><%= size_elem[1] % (ratio*size_elem[0]).floor %></a></li>
                  <%end%>
                <%end%>
            <%end%>
            <%
              del_serv = document[:delivery_service]
              manifest_base_url = 'https://iiif.lib.harvard.edu/manifests/' + (del_serv == 'pds'? 'drs': del_serv) + ':'
            %>
            <li><a href="<%= manifest_base_url + document[:drs_file_id] %>">IIIF Manifest</a></li>
           </ul>
         </div>
       <%end%>
        <%
        if !document[:permalink].nil? && document[:permalink].kind_of?(String) && document[:permalink] != ''
          %>
            <div class="permalink"><a href="<%=document[:permalink]%>">Permalink</a></div>
          <%
        end
        %>
        <%
        if !document[:digital_collections_links].nil? && document[:digital_collections_links].kind_of?(Array) && document[:digital_collections_links].length > 0
          %>
            <dl class="dl-vertical dl-invert dl-appears-in clearfix">
            <dt class="blacklight-title_extended">This item appears in</dt>
          <%
          document[:digital_collections_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:label]%></a></dd>
          <%
          end
          %>
            </dl>
          <%
        end
        %>

      <dl class="dl-vertical dl-invert dl-more-details clearfix">
        <%
        if (!document[:hollis_links].nil? && document[:hollis_links].kind_of?(Array) && document[:hollis_links].length > 0)  ||
        (!document[:hollis_image_links].nil? && document[:hollis_image_links].kind_of?(Array) && document[:hollis_image_links].length > 0) ||
        (!document[:finding_aid_links].nil? && document[:finding_aid_links].kind_of?(Array) && document[:finding_aid_links].length > 0)
        %>
          <dt class="blacklight-title_extended clearfix">More item details</dt>
        <%
        end
        if !document[:hollis_links].nil? && document[:hollis_links].kind_of?(Array)
          document[:hollis_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end

        if !document[:hollis_image_links].nil? && document[:hollis_image_links].kind_of?(Array)
          document[:hollis_image_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end

        if !document[:finding_aid_links].nil? && document[:finding_aid_links].kind_of?(Array)
          document[:finding_aid_links].each do |x|
          %>
            <dd class="blacklight-title_extended"><a href="<%=x[:url]%>"><%=x[:link_text]%></a> <%=x[:label]%></dd>
          <%
          end
        end
        %>
      </dl>
    </div>
  </div>
</div>
